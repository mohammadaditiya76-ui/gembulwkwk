// ===== SISTEM UPLOAD GAMBAR + AUTO SAVE LOCALSTORAGE =====

// Daftar elemen gambar yang ada di admin panel
const imageInputs = document.querySelectorAll(
    '.featured-image-input, .gallery-image-input, .product-image-input, #admin-hero-image-file'
);

// Fungsi membaca gambar
function readImageFile(input, callback) {
    const file = input.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => callback(e.target.result);
    reader.readAsDataURL(file);
}

// Saat user upload gambar
imageInputs.forEach(input => {
    input.addEventListener('change', () => {
        const id = input.id;
        const key = `img_${id}`; // penyimpanan di localStorage

        readImageFile(input, (base64) => {
            // Simpan ke localStorage
            localStorage.setItem(key, base64);

            // Temukan preview yang cocok
            const previewId = input.dataset.featured
                ? `featured-preview-${input.dataset.featured}`
                : input.dataset.product
                ? `product-preview-${input.dataset.product}`
                : input.dataset.gallery
                ? `gallery${input.dataset.gallery}-preview`
                : id === "admin-hero-image-file"
                ? "hero-image-preview"
                : null;

            if (previewId) {
                const preview = document.getElementById(previewId);
                preview.innerHTML = `<img src="${base64}" style="width:100%;height:100%;object-fit:cover;border-radius:10px;">`;
            }
        });
    });
});

// Saat halaman baru dibuka, load gambar yang sudah disimpan
window.addEventListener('load', () => {
    Object.keys(localStorage).forEach(key => {
        if (!key.startsWith("img_")) return;

        const base64 = localStorage.getItem(key);
        const id = key.replace("img_", "");

        const input = document.getElementById(id);

        if (!input) return;

        const previewId = input.dataset.featured
            ? `featured-preview-${input.dataset.featured}`
            : input.dataset.product
            ? `product-preview-${input.dataset.product}`
            : input.dataset.gallery
            ? `gallery${input.dataset.gallery}-preview`
            : id === "admin-hero-image-file"
            ? "hero-image-preview"
            : null;

        if (previewId) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = `<img src="${base64}" style="width:100%;height:100%;object-fit:cover;border-radius:10px;">`;
        }
    });
});
